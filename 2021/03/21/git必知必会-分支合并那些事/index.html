<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="git必知必会-分支合并那些事"><meta name="keywords" content="git"><meta name="author" content="actake"><meta name="copyright" content="actake"><title>git必知必会-分支合并那些事 | actake的博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta name="google-site-verification" content="VkvnbEA39tPUuDz5C-X_b9RjJPpwsw4uJDNp2LcX_w8"><meta name="baidu-site-verification" content="i0nykfFg1m"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E8%B7%AF%E5%90%88%E5%B9%B6%EF%BC%88Three-way-merge%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">三路合并（Three-way merge）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-%E5%90%88%E5%B9%B6%E7%AD%96%E7%95%A5"><span class="toc-number">4.</span> <span class="toc-text">Git 合并策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fast-forward"><span class="toc-number">4.1.</span> <span class="toc-text">Fast-forward</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recursive"><span class="toc-number">4.2.</span> <span class="toc-text">Recursive</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">一个简单的例子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%A4%8D%E6%9D%82%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">4.2.2.</span> <span class="toc-text">一个复杂的例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ours"><span class="toc-number">4.3.</span> <span class="toc-text">Ours</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Theirs"><span class="toc-number">4.4.</span> <span class="toc-text">Theirs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Octopus"><span class="toc-number">4.5.</span> <span class="toc-text">Octopus</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E7%AD%94"><span class="toc-number">5.</span> <span class="toc-text">解答</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%841%EF%BC%9Amerge-%E5%92%8C-rebase-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.</span> <span class="toc-text">附1：merge 和 rebase 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#merge"><span class="toc-number">7.1.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rebase"><span class="toc-number">7.2.</span> <span class="toc-text">rebase</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%842%EF%BC%9Acherry-pick-%E8%AF%A6%E8%A7%A3"><span class="toc-number">8.</span> <span class="toc-text">附2：cherry-pick 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">8.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">8.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">8.3.</span> <span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%843%EF%BC%9Amerge-%E5%92%8C-rebase-%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">附3：merge 和 rebase 相关参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#merge-1"><span class="toc-number">9.1.</span> <span class="toc-text">merge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rebase-1"><span class="toc-number">9.2.</span> <span class="toc-text">rebase</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%844%EF%BC%9Acherry-pick-%E7%94%A8%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">附4：cherry-pick 用法</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.jpg"></div><div class="author-info__name text-center">actake</div><div class="author-info__description text-center">一只前端</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">2</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">actake的博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">git必知必会-分支合并那些事</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-21</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><hr>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><strong>小菜</strong>：“大鸟我最近碰到一件怪事”</p>
<p><strong>大鸟</strong>：“哦？说来听听。”</p>
<p><strong>小菜</strong>：“事情是这样的…”</p>
<p><strong>旁白</strong>：<br>  如下图，小菜基于 master 分支的提交 C1 迁出了一条新分支 dev，并添加了 feature.js（D1），这是一个新功能；</p>
<p>  然后他切换到 master 分支，发现此时同事有一个新提交 C2。小菜很自信，他直接把自己的 dev 分支合了过来（E1），然后发布到了测试环境。</p>
<p>  第二天，QA 提了 bug，小菜排查后发现是由于昨天添加了 feature.js 的原因，所以小菜只好把昨天的提交（E1） revert 了（E2）；</p>
<p>  之后小菜切换到自己的 dev 分支修复 fuature.js 的问题。他添加了一个 fix.js 并 import 了 feature.js。</p>
<p>  这次小菜长了心眼，在合并 dev 分支后（F），他在本地自测了一下。但奇怪的是，他发现合并后自己的 feature.js 文件消失了！</p>
<p>  <img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/example.drawio.png"></p>
<p><strong>大鸟</strong>：“我知道了，要解决这个问题，我们得先了解一下分支合并的一些相关知识…”</p>
<a id="more"></a>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>为什么小菜的 feature.js 会丢失？</li>
<li>怎样操作才能正常合并 dev 分支到 master？</li>
</ol>
<h2 id="三路合并（Three-way-merge）"><a href="#三路合并（Three-way-merge）" class="headerlink" title="三路合并（Three-way merge）"></a>三路合并（Three-way merge）</h2><p>首先我们先来了解一下三路合并算法，这是文件合并的常用算法。</p>
<p>以下内容引用自<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%88%E5%B9%B6_(%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6)#%E4%B8%89%E8%B7%AF%E5%90%88%E5%B9%B6">维基百科</a>：</p>
<blockquote>
<p>三路合并（three-way merge），首先考虑对文件 A、文件 B 以及它们的共同祖先文件 C 做差异分析。</p>
<p>对于文件中的每节(sector)，如果上述三个文件中有两个文件该节的内容一致，那么抛弃文件 C 中该节的内容，保留与文件 C 中不同的内容放到结果文件中。</p>
<p>如果该节在三个文件中都不同，那么这个冲突需要手工合并。</p>
</blockquote>
<p>举个例子：</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/three-way-merge.drawio.png"></p>
<p>如图所示，因为 base 版本和 ours 版本的内容一致，所以我们最终选择 theirs 版本做为合并结果。</p>
<h2 id="Git-合并策略"><a href="#Git-合并策略" class="headerlink" title="Git 合并策略"></a>Git 合并策略</h2><p>接下来我们了解一下 Git 的合并策略，包括：<strong>Fast-forward、Recursive、Ours、Theirs、Octopus</strong> 等</p>
<h3 id="Fast-forward"><a href="#Fast-forward" class="headerlink" title="Fast-forward"></a><strong>Fast-forward</strong></h3><p>Fast-forward 是一个比较简单的合并策略。它的核心内容是：<br><strong>在分支合并时，如果发现<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88_(%E5%9B%BE%E8%AE%BA)">最近公共祖先</a>就是它们其中之一，就会直接移动文件指针，不产生新的提交</strong></p>
<h3 id="Recursive"><a href="#Recursive" class="headerlink" title="Recursive"></a><strong>Recursive</strong></h3><p>Recursive 也被称为递归三路合并，是 Git 分支合并中最常用的策略。<br>核心内容是：<strong>递归寻找最近公共祖先，并以其为 base 节点，进行递归三路合并。</strong><br>下面我们来看几个例子：</p>
<blockquote>
<p>注：以下所有 Git 提交树，都以其节点名称作为文件内容</p>
</blockquote>
<h4 id="一个简单的例子"><a href="#一个简单的例子" class="headerlink" title="一个简单的例子"></a><strong>一个简单的例子</strong></h4><p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/simple-recursive.drawio.png"></p>
<p>当我们要合并中间两个提交 A、B 时，会去寻找他们的最近公共祖先，所以就找到了左边的 A 节点；</p>
<p>以它为 base 节点，根据三路合并算法，最后的合并结果为 B。</p>
<p><strong>小菜</strong>：“不是说叫做递归三路合并吗，这里完全没有递归操作啊？”</p>
<p><strong>大鸟</strong>：“别急，下面我们来看一个更加复杂的例子。”</p>
<h4 id="一个复杂的例子"><a href="#一个复杂的例子" class="headerlink" title="一个复杂的例子"></a><strong>一个复杂的例子</strong></h4><p>但实际情况往往没那么简单，可能出现层级较深、复杂交叉等情况。如下图：</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/complex-recursive.drawio.png"></p>
<p>我们发现，在合并 BC 节点的时候，出现了两个最近公共祖先，分别为 A、B，如下图：</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/path-analysis-compare.drawio.png"></p>
<p>所以我们需要再递归，直至寻找到唯一的最近公共祖先，为最左边的 A 节点。</p>
<p>那么我们的合并节点和顺序就可以确定了，如下图：</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/merge-element.drawio.png"></p>
<p><strong>首先我们以 A 为 base，合并 AB 节点，得到一个临时节点，根据三路合并算法，它的结果是 B。</strong></p>
<p><strong>然后以这个临时节点 B 为 base，合并 BC 节点，得到最终结果为 C。</strong></p>
<h3 id="Ours"><a href="#Ours" class="headerlink" title="Ours"></a><strong>Ours</strong></h3><p>Ours 的合并策略比较简单。它的核心内容是：<strong>丢弃目标分支的内容，采用当前分支的内容</strong></p>
<p>所以在这种合并策略下，<strong>最后的内容和没有合并时的当前分支的内容是一样的</strong>。</p>
<blockquote>
<p>注：Ours 策略和 <code>-Xours</code> 参数不一样， Ours 策略无论有没有冲突发生，都会丢弃目标分支的修改。<br>而 <code>-Xours</code> 参数则是仅在出现冲突时这么处理。</p>
</blockquote>
<h3 id="Theirs"><a href="#Theirs" class="headerlink" title="Theirs"></a><strong>Theirs</strong></h3><p><strong>该策略目前已不可用，仅在旧版本的 Git 中存在！</strong><br>Theirs 和 Ours 类似，只是保留内容的目标变了。它的核心内容是：<strong>丢弃当前分支的内容，采用目标分支的内容</strong></p>
<p>所以在这种合并策略下，<strong>最后的内容和没有合并时的目标分支的内容是一样的</strong>。</p>
<h3 id="Octopus"><a href="#Octopus" class="headerlink" title="Octopus"></a><strong>Octopus</strong></h3><p>这个策略的意思是章鱼。顾名思义，这种策略可以用于合并多条分支。不过，如果出现需要手工解决的冲突，操作将执行失败。</p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>那么回到我们最开始的例子以及问题</p>
<p><strong>大鸟</strong>：“小菜，现在知道为什么你的合并操作结果不对了吗？”</p>
<p><strong>小菜</strong>：知道了，我们首先寻找 D2 和 E2 的最近公共祖先，为 D1，如下图</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/example-path-analysis.drawio.png"></p>
<p>D1 不符合使用 Fast-forward 策略的条件， 所以根据 recursive 策略， 以 D1 为 base 节点，对 D1、D2、E2 进行差异分析：</p>
<ul>
<li><p>D2 的变更是：添加了 fix.js；</p>
</li>
<li><p>E2 的变更是：删除了 feature.js（这里 revert 等同与删除）。</p>
</li>
</ul>
<p>所以根据三路合并算法，<strong>两个文件的变更都被自动合并了</strong>，所以 feature.js 被删除了</p>
<p><strong>大鸟</strong>：“说得没错，但这只是对错误进行解释，并不是根本原因”</p>
<p><strong>小菜</strong>：“那根本原因是什么呢？”</p>
<p><strong>大鸟</strong>：“根本原因就是你在 dev 分支上开发的时候，内容并不是最新的”</p>
<p><strong>小菜</strong>：“我知道了！所以我的 dev 分支应该先拉取 master 的最新代码，再进行开发；<br>这样我在合并的时候就根本不会使用 Recursive 策略，而是根据 Fast-forward 策略合并就好了！”</p>
<p><strong>大鸟</strong>：“不错不错，孺子可教也…”</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/192972614">这才是真正的 Git——分支合并</a></li>
<li><a target="_blank" rel="noopener" href="https://marsishandsome.github.io/2019/07/Three_Way_Merge">Git三路合并算法(Three Way Merge)</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/2334288//">大话设计模式-程杰</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%88%E5%B9%B6_(%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6)">维基百科-合并 (版本控制)</a></li>
</ul>
<h2 id="附1：merge-和-rebase-的区别"><a href="#附1：merge-和-rebase-的区别" class="headerlink" title="附1：merge 和 rebase 的区别"></a>附1：merge 和 rebase 的区别</h2><h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p>merge 操作会生成新节点，并保留每个提交历史的祖先。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>使用简单，易于理解。</li>
<li>能够记录 commit 、分支历史情况。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>历史记录会比较杂乱。</li>
</ul>
<h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p>rebase 是将一个分支的修改重写到另一个分支上，不需要创建新的提交。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>能够合并 commit 历史</li>
<li>易于制造更加干净、线性的提交树</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>会改写历史记录，可能会丢失上下文。</li>
</ul>
<h2 id="附2：cherry-pick-详解"><a href="#附2：cherry-pick-详解" class="headerlink" title="附2：cherry-pick 详解"></a>附2：cherry-pick 详解</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>将某些提交<strong>复制</strong>到当前分支上。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>小菜最近接到了一个新需求，需要引用一个外部库 demo.js。他开了一条新分支 demo，在该分支上进行新需求的开发。</p>
<p>由于他不熟悉这个库，所以在开发过程中，他添加了一些测试代码，<strong>这些测试代码分散在不同的提交记录中</strong>。</p>
<p>某一天，这个新需求开发好了，小菜准备将分支合并到 develop 上，然后提交代码。</p>
<p><strong>但是总不能将测试代码也一起提交吧？或者手动删除？不行，效率太低，小菜犯愁了。</strong></p>
<p>这时，小菜的同事建议可以使用 <code>cherry-pick</code>，小菜赶紧了解了一下，发现还真的能够快速解决问题。</p>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/cherry-pick-example.drawio.png"></p>
<p>如上图所示，提交记录中 M 开头的表示 demo 分支的主要功能，是需要被合并到 develop 分支的；</p>
<p>而 T 开头的则是测试代码，这些提交是不想合并到 develop 分支的。</p>
<p>所以小菜切换到 develop 分支并运行了如下命令，解决了这个问题：</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">git cherry-pick M1 M2</span><br></pre></td></tr></table></figure>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><p>现在我们来看一下 cherry-pick 这个命令的优缺点。</p>
<p><strong>优点</strong>：能够快速进行提交的复制、移动</p>
<p><strong>缺点</strong>：由于 cherry-pick 是 <strong>复制</strong> 提交，而不是合并。<br>所以如果分支并行地进行开发，在合并时可能会出现问题，<strong>而且不会出现冲突提示。</strong>我们来看一个简单的例子：</p>
<blockquote>
<p>注：这里提交节点附近的文字代表文件内容</p>
</blockquote>
<p><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/cherry-pick-merge-error-example.drawio.png"></p>
<p>如上图，在节点 C 我们使用了 cherry-pick 从 dev 分支复制了 E 节点到 master 分支（<strong>这里虚线代表进行 cherry-pick 操作，不代表 merge</strong>）。</p>
<p>然后我们在 dev 分支修改了文件内容，变为 cherry，此时将 dev 分支合并到 master。</p>
<p>我们很容易知道 CF 的最近公共祖先为 A，根据三路合并算法，所以最终的合并结果为 pick，这并不是我们所期望的。</p>
<p>而如果是合并操作，那么 CF 的最近公共祖先则是 E 节点，此时根据三路合并算法，结果就变成 cherry 了，这是正确的结果。</p>
<p><strong>所以我们在使用 cherry-pick 时，需要注意使用场景，不能盲目使用。</strong></p>
<h2 id="附3：merge-和-rebase-相关参数"><a href="#附3：merge-和-rebase-相关参数" class="headerlink" title="附3：merge 和 rebase 相关参数"></a>附3：merge 和 rebase 相关参数</h2><h3 id="merge-1"><a href="#merge-1" class="headerlink" title="merge"></a>merge</h3><ul>
<li><p><code>--stat</code> 和 <code>-n</code> 以及 <code>--no-stat</code></p>
<ul>
<li><p><code>--stat</code> 参数会在合并的提交信息后附加文件差异信息（默认就是会附加的，信息如下图）<br><img src="/2021/03/21/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%88%86%E6%94%AF%E5%90%88%E5%B9%B6%E9%82%A3%E4%BA%9B%E4%BA%8B/file-change.drawio.png"></p>
</li>
<li><p><code>-n</code>、 <code>--no-stat</code> 与 <code>--stat</code> 相反，不附加文件差异信息</p>
</li>
</ul>
</li>
<li><p><code>--squash</code> 和 <code>--no-squash</code></p>
<ul>
<li><p><code>--squash</code> 参数表示会将被合并的分支提交压缩在一起成为一个新节点，并需要重新确认提交信息。</p>
</li>
<li><p><code>--no-squash</code> 则相反。</p>
</li>
</ul>
<blockquote>
<p>注: 该操作会改变 author</p>
</blockquote>
</li>
<li><p><code>--commit</code> 和 <code>--no-commit</code></p>
<ul>
<li><p><code>--commit</code> 参数表示在合并后会自动进行提交。</p>
</li>
<li><p><code>--no-commit</code> 参数则相反，不进行自动提交。</p>
</li>
</ul>
</li>
<li><p><code>--e</code>, <code>--edit</code> 和 <code>--no-edit</code></p>
<ul>
<li><p><code>--e</code>、 <code>--edit</code> 表示在成功合并前进行合并信息的编辑。</p>
</li>
<li><p><code>--no-edit</code> 则相反，即使用自动合并的信息。</p>
</li>
</ul>
</li>
<li><p><code>--ff</code> 和 <code>--no-ff</code> 以及 <code>--ff-only</code></p>
<ul>
<li><p><code>--ff</code> 指 fast-forward 模式，使用该模式进行合并时将不会创造一个新的提交节点。</p>
</li>
<li><p><code>--no-ff</code> 则相反，在合并时会创建一个新的提交节点。</p>
</li>
<li><p><code>--ff-only</code> 表示如果合并过程出现冲突， Git 会自动 abort 此次合并。</p>
</li>
</ul>
</li>
<li><p><code>--Xours</code> 和 <code>--Xtheirs</code></p>
<p>用于指定在出现冲突时，完全采用一方的变动而忽略另一方。</p>
</li>
<li><p><code>--s</code>, <code>--strategy</code> <strategy></p>
<p>用于指定合并的策略，合并策略详见上方正文。</p>
</li>
<li><p><code>-X</code>, <code>--strategy-option</code></p>
<p>用于指定合并策略的具体参数。</p>
</li>
<li><p><code>-m</code>, <code>--message</code> <message></p>
<p>用于指定合并的提交信息（仅在非 fast-forward 模式下可用）</p>
</li>
<li><p><code>-abort</code></p>
<p>退出合并（一般在出现冲突时使用）。</p>
</li>
</ul>
<h3 id="rebase-1"><a href="#rebase-1" class="headerlink" title="rebase"></a>rebase</h3><ul>
<li><p><code>--i</code>, <code>--interactive</code></p>
<p>打开互动模式，以 GUI 的形式让使用者进行操作。</p>
</li>
<li><p><code>--stat</code> 和 <code>-n</code> 以及 <code>--no-stat</code></p>
<p>同上方 merge</p>
</li>
<li><p><code>--continue</code></p>
<p>表示继续 rebase 流程，通常用于 rebase 处理冲突后。</p>
</li>
<li><p><code>--skip</code></p>
<p>表示直接跳过当前分支的提交，采用目标分支的提交。</p>
</li>
<li><p><code>--abort</code></p>
<p>表示放弃 rebase，并将 HEAD 重置为原始分支。</p>
</li>
<li><p><code>--quit</code></p>
<p>表示放弃 rebase。</p>
<blockquote>
<p>和 <code>--abort</code> 的区别： <code>--quit</code> 不会重置工作区和索引</p>
</blockquote>
</li>
</ul>
<h2 id="附4：cherry-pick-用法"><a href="#附4：cherry-pick-用法" class="headerlink" title="附4：cherry-pick 用法"></a>附4：cherry-pick 用法</h2><ul>
<li><p>最常见的用法：</p>
<blockquote>
<p>注：cherry-pick 后如果使用分支名称，则复制的是分支的最新提交。</p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">git cherry-pick &lt;commitHash&gt;</span><br><span class="line">git cherry-pick &lt;branch&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>复制多个提交：</p>
<blockquote>
<p>注：</p>
<ol>
<li>注意顺序，越前面的提交越早</li>
<li>git cherry-pick commitHash1..commitHashN，这种写法，提交必须是连续的</li>
</ol>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">git cherry-pick &lt;commitHash1&gt; &lt;commitHash2&gt;</span><br><span class="line">git cherry-pick commitHash1..commitHashN</span><br></pre></td></tr></table></figure></li>
<li><p><code>--continue</code></p>
<p>同 rebase</p>
</li>
<li><p><code>--abort</code></p>
<p>同 rebase</p>
</li>
<li><p><code>--quit</code></p>
<p>同 rebase</p>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">actake</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://actake.github.io/2021/03/21/git必知必会-分支合并那些事/">https://actake.github.io/2021/03/21/git必知必会-分支合并那些事/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://actake.github.io">actake的博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/git/">git</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2021/03/08/git%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><span>git必知必会-基础知识</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '0555b0806744360ef10a',
  clientSecret: 'f72182101eb9ebc44355cd993a0253c242a6a450',
  repo: 'actake.github.io',
  owner: 'actake',
  admin: 'actake',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2023 By actake</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>